{% extends 'base.html' %}

{% block title %}Report Item - Lost & Found{% endblock %}

{% block content %}
<div class="min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4">
    <div class="bg-white rounded-lg shadow-lg p-8 max-w-2xl w-full">

        <h1 class="text-3xl font-bold text-indigo-600 mb-2 text-center">Report Item</h1>
        <p class="text-gray-600 mb-6 text-center">
            Help reunite items with their owners. Your report will be verified by our admin team.
        </p>

        <!-- Inline message -->
        <div id="formMessage" class="hidden mb-4 p-3 rounded text-sm font-semibold"></div>

        <form id="reportForm" enctype="multipart/form-data" class="space-y-4">

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-gray-700 font-semibold mb-2">Type *</label>
                    <select name="type" required
                        class="w-full border-2 border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:border-indigo-600">
                        <option value="">Select Type</option>
                        <option value="lost">Lost Item</option>
                        <option value="found">Found Item</option>
                    </select>
                </div>

                <div>
                    <label class="block text-gray-700 font-semibold mb-2">Item Name *</label>
                    <input type="text" name="name" required
                        class="w-full border-2 border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:border-indigo-600"
                        placeholder="e.g. iPhone 14">
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-gray-700 font-semibold mb-2">Category *</label>
                    <select name="category" required
                        class="w-full border-2 border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:border-indigo-600">
                        <option value="">Select Category</option>
                        <option>Electronics</option>
                        <option>Jewelry</option>
                        <option>Documents</option>
                        <option>Accessories</option>
                        <option>Other</option>
                    </select>
                </div>

                <div>
                    <label class="block text-gray-700 font-semibold mb-2">Color</label>
                    <input type="text" name="color"
                        class="w-full border-2 border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:border-indigo-600"
                        placeholder="e.g. Black">
                </div>
            </div>

            <div>
                <label class="block text-gray-700 font-semibold mb-2">Location *</label>
                <input type="text" name="location" required
                    class="w-full border-2 border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:border-indigo-600"
                    placeholder="Where was it lost or found?">
            </div>

            <div>
                <label class="block text-gray-700 font-semibold mb-2">Description *</label>
                <textarea name="description" rows="5" required
                    class="w-full border-2 border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:border-indigo-600"
                    placeholder="Provide identifying details"></textarea>
            </div>

            <div>
                <label class="block text-gray-700 font-semibold mb-2">Upload Photo (Optional)</label>
                <input type="file" id="itemImage" name="image" accept="image/*"
                    class="w-full border-2 border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:border-indigo-600">
                <p class="text-sm text-gray-500 mt-1">Max size: 5MB</p>
                <div id="imagePreview" class="mt-3"></div>
            </div>

            <button id="submitBtn" type="submit"
                class="w-full bg-indigo-600 text-white font-bold py-3 rounded-lg hover:bg-indigo-700 transition">
                Submit Report
            </button>
        </form>
    </div>
</div>

<script>
const imageInput = document.getElementById('itemImage');
const preview = document.getElementById('imagePreview');

imageInput.addEventListener('change', function () {
    const file = this.files[0];
    preview.innerHTML = '';

    if (!file) return;

    if (file.size > 5 * 1024 * 1024) {
        preview.innerHTML = '<p class="text-red-600 text-sm">Image must be less than 5MB.</p>';
        this.value = '';
        return;
    }

    const reader = new FileReader();
    reader.onload = e => {
        preview.innerHTML = `<img src="${e.target.result}" class="h-40 rounded shadow">`;
    };
    reader.readAsDataURL(file);
});

document.getElementById('reportForm').addEventListener('submit', function (e) {
    e.preventDefault();

    const formData = new FormData(this);
    const messageDiv = document.getElementById('formMessage');
    const submitBtn = document.getElementById('submitBtn');

    messageDiv.className = 'hidden mb-4 p-3 rounded text-sm font-semibold';

    submitBtn.disabled = true;
    submitBtn.textContent = 'Submitting...';

    fetch('/report', {
        method: 'POST',
        body: formData
    })
    .then(res => res.json())
    .then(data => {
        messageDiv.classList.remove('hidden');

        if (data.success) {
            messageDiv.classList.add('bg-green-100', 'text-green-700');
            messageDiv.textContent = data.message;

            setTimeout(() => {
                window.location.href = '{{ url_for("home") }}';
            }, 1500);
        } else {
            messageDiv.classList.add('bg-red-100', 'text-red-700');
            messageDiv.textContent = data.message;
            submitBtn.disabled = false;
            submitBtn.textContent = 'Submit Report';
        }
    })
    .catch(() => {
        messageDiv.classList.remove('hidden');
        messageDiv.classList.add('bg-red-100', 'text-red-700');
        messageDiv.textContent = 'Something went wrong. Please try again.';
        submitBtn.disabled = false;
        submitBtn.textContent = 'Submit Report';
    });
});
</script>
{% endblock %}

